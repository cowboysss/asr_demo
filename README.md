## 程序文件说明-基于Python 3.5开发
server.py 是main文件，服务部分的程序运行该文件
voice_parse.py为录音和语音识别的class文件和函数文件
nlp_baidu.py 是利用百度云进行NLP的相关程序，可以直接从提取的汉语文字中进行控制指令的提取
machine_id.py 是设备的id号，我改过文件名和里面的内容***刘兴成使用的时候需要注意***

## 依赖文件如下
1. 百度语音SDK库文件，安装方法`pip install baidu-aip`
2. playsound包，播放语音用，安装方法`pip install playsound`(现在没有用了) 
3. pyaudio,录音用，安装方法`pip install playsound`
4. omxplayer 播放语音用，理论上树莓派自带
5. ffmpeg 需要安装，用于录音之后的转码，然后上传到baidu云进行解析

## 一、程序的使用方法
1. 运行server.py文件
2. 当命令行出现X:字符时，输入不同的字符回车可执行相应的命令，x是进行录音并解析然后进行设备控制，q是退出设备，其他字符俊辉不起作用
3. 当输入x字符回车后，等待命令行出现`recording...`字符时，对着Mic读出指令，指令格式见`二、语音的指令格式`
4. 识别成功后会播放识别成功的语音

## 二、语音的指令格式
语音的指令格式：控制时间+控制动作+控制设备，对应于nlp_baidu.py文件中的`Control_Command`类
例如：明天晚上十点五十分打开电饭煲
#### 2.1. 控制时间(可以不要)-
1. 今天、明天、后天作为时间中的day属性，如果不要的话，默认是今天。
2. 上午、早上、凌晨、下午、晚上作为一天中上半天和下半天的判断，如果不要的话默认是上午。
3. 几点几分，也可以是几点
4. 由1~3这三块随机组合可以形成控制时间的指令

#### 2.2. 控制动作
1. 表示关闭动作：关闭、关上、关
2. 表示开启动作：打开、开、开启
3. 表示读取设备信息的动作：读取、获取

#### 2.3. 控制设备
台灯、床头灯、客厅灯、房门、门、空调、房间温度、客厅温度、室外温度、室内湿度、室外湿度、电饭煲、灯
》注意
门和房门是等价的
灯的属性我初步定义是所有的灯，也就是控制台灯、床头灯、客厅灯，这个主要取决于刘兴成的控制部分

#### 2.4. 指令示例
指令是从上述控制时间、控制动作、控制设备中的词组合而成
例如：
1. 开灯
2. 开门
3. 关门
4. 打开电饭煲
5. 读取室内温度
6. 打开客厅灯
7. 明天晚上十点十分打开空调
8. 晚上十点打开空调
9. 早上十点关闭灯
10. 九点十分关灯

#### 2.5.`Control_Command`类说明
在进行录音、语音识别、nlp分析后，可以获得控制指令，其中控制指令返回的是`Control_Command`的类
##### 2.5.1. 初始化
__init__(控制时间,控制动作,控制设备,备用参数)
控制时间-datetime
控制动作-int
控制设备-int
备用参数-暂时未定
这四个参数默认都是None的类型
##### 2.5.2 设置控制指令的参数
set_command(控制时间,控制动作,控制设备,备用参数)
同初始化的部分
##### 2.5.3 控制时间
如果控制时间是None的类型，则表示立即进行控制
##### 2.5.4 控制指令
1. 值为0代表关闭
2. 值为1代表打开
3. 值为2代表读取
##### 2.5.5 控制设备
设备id部分主要参考`machine_id.py`文件
设备id非负数部分都是有的设备
当我们说的指令中，设备不存在，或者不在我们的列表中，那么控制设备的值为-1，表示设备不在列表中，或者识别错误了
##### 2.5.6 具备__str__属性
`Control_Command`类支持print打印，方便调试使用
例如：
``` python
a = Control_Command()
print(a) # 可以获得具体的控制指令信息
```
##### 2.5.7 从已有的对象中获得控制时间、控制指令、控制对象
1. 控制时间：使用`对象.ctrl_time`的方法
2. 控制指令：使用`对象.ctrl_action`的方法
3. 控制设备：使用`对象.ctrl_device`的方法

## 三、server.py文件说明
该文件主要是服务的主要文件
#### 3.1 使用方法
    main_client = control_server()
    main_client.run(main_client.RUN_WHEN_GET_CHAR)
#### 3.2 control_server类说明
#####3.2.1 初始化
1. 录音和语音识别的类parse_zh()初始化，该类在voice_parse.py文件夹内
2. nlp自然语言识别的类ParseCommand初始化，该类在nlp_baidu.py文件内
3. 控制设备相关的类初始化，***这一个部分需要刘兴成添加***

##### 3.2.2 run方法
run(模式)
模式有3种可选：
1. RUN_ONCE：值为0，运行一次就停止
2. RUN_WHEN_KEY_CTRL：值为1，什么时候开始录音受外部的一个物理按键控制，当run()运行在这个模式的时候，需要完善wait_key_press()方法
3. RUN_WHEN_GET_CHAR：值为2，什么时候开始录音受命令行的字符控制，**当前运行在该模式下**

##### 3.2.3 speech_and_control方法
**这个方法是录音和控制程序的主要部分**
目前我已经能够获得self.command
刘兴成需要在这里根据self.command进行设备的控制

## 四、voice_parse.py文件说明
主要是录音、解析语音、对已有的字符串进行语音合成并播放三个功能

#### 4.1 parse_zh类

##### 4.1.1 record_voice()
无输入参数，调用该方法可获得4秒钟的录音
使用了ffmpeg进行编码转换

##### 4.1.2 get_result()
无输入参数，单用该方法可以把record_voice()得到的录音解析得到中文字符串
返回值是 msg, err_no
msg是str类型
err_no是int类型，0表示转换成功，非0表示转换失败

##### 4.1.3 get_voice(msg)
输入参数：msg，类型是str，可为中英文字符串
根据输入的msg字符串，从百度云中心获得该字符串的合成语音，并播放合成的语音
在树莓派上使用到了应用omxplayer

## 五、nlp_baidu.py
自然语言识别出控制指令的文件，利用baidu云进行的分词，并在分词的基础上结合自己的算法提取出控制指令信息，自己的算法比较粗暴

#### 5.1 Control_Command()类说明
二、语音的指令格式说明过了

#### 5.2 ParseCommand()类说明

##### 5.2.1 get_command(msg)方法
根据语音识别后的中文字符串，获得控制指令的方法
输入参数：msg，类型str
返回值：ctrl_command，类型Control_Command


##### 5.2.2 get_words(text)
对text进行分词，利用了baidu云
输入参数：text，类型str
返回值：分词后的dict类型

#### 5.3 get_command_time()独立函数
从分词后的时间属性的list中，将中文数字变成int
该函数的返回值是control_time，类型是datetime

#### 5.4 后面的一些独立函数都是和提取出时间有关系，不在这里赘述了
